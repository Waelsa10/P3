{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/waels/OneDrive/Desktop/Expo%20projects/P3/pages/chat/%5Bid%5D.js"],"sourcesContent":["// pages/chat/[id].js\r\nimport React, { useEffect, useState, useContext } from \"react\";\r\nimport { auth, db } from \"../../firebase\";\r\nimport styled from \"styled-components\";\r\nimport dynamic from \"next/dynamic\";\r\nimport Head from \"next/head\";\r\nimport { useRouter } from \"next/router\";\r\nimport { doc, getDoc } from \"firebase/firestore\";\r\nimport { DarkModeContext } from \"../../components/DarkModeProvider\";\r\n\r\nconst Sidebar = dynamic(() => import(\"../../components/Sidebar\"), { ssr: false });\r\nconst ChatScreen = dynamic(() => import(\"../../components/ChatScreen\"), { ssr: false });\r\n\r\nfunction ChatPage() {\r\n  const [isOnline, setIsOnline] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [chat, setChat] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [sidebarOpen, setSidebarOpen] = useState(false);\r\n  const [isMobile, setIsMobile] = useState(false);\r\n  \r\n  const router = useRouter();\r\n  const chatId = router.query.id;\r\n\r\n  // Get dark mode context\r\n  const darkModeContext = useContext(DarkModeContext);\r\n  const { darkMode } = darkModeContext || { darkMode: false };\r\n\r\n  // Detect mobile/tablet screen size\r\n  useEffect(() => {\r\n    const checkScreenSize = () => {\r\n      const mobile = window.innerWidth <= 1024;\r\n      setIsMobile(mobile);\r\n    };\r\n\r\n    checkScreenSize();\r\n    window.addEventListener('resize', checkScreenSize);\r\n    return () => window.removeEventListener('resize', checkScreenSize);\r\n  }, []);\r\n\r\n  // Close sidebar when chat loads on mobile\r\n  useEffect(() => {\r\n    if (isMobile && chatId) {\r\n      setSidebarOpen(false);\r\n    }\r\n  }, [chatId, isMobile]);\r\n\r\n  // Add online/offline detection\r\n  useEffect(() => {\r\n    const handleOnline = () => setIsOnline(true);\r\n    const handleOffline = () => setIsOnline(false);\r\n\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n    setIsOnline(navigator.onLine);\r\n\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n    };\r\n  }, []);\r\n\r\n  // Fetch chat data\r\n  useEffect(() => {\r\n    if (!chatId || !isOnline) return;\r\n\r\n    let mounted = true;\r\n    const fetchChat = async () => {\r\n      try {\r\n        setError(null);\r\n        const chatRef = doc(db, \"chats\", chatId);\r\n        const chatSnap = await getDoc(chatRef);\r\n\r\n        if (!chatSnap.exists()) {\r\n          throw new Error(\"Chat not found\");\r\n        }\r\n\r\n        if (mounted) {\r\n          setChat({ id: chatSnap.id, ...chatSnap.data() });\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Error fetching chat:\", err);\r\n        if (mounted) {\r\n          setError(err.message);\r\n          // Only redirect on specific errors\r\n          if (err.code === \"not-found\") {\r\n            router.replace(\"/\");\r\n          }\r\n        }\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchChat();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [chatId, router, isOnline]);\r\n\r\n  if (!isOnline) {\r\n    return (\r\n      <Container darkMode={darkMode}>\r\n        <Head>\r\n          <title>Offline - Chat</title>\r\n        </Head>\r\n        <OfflineMessage darkMode={darkMode}>\r\n          You are currently offline. Please check your internet connection.\r\n        </OfflineMessage>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <Container darkMode={darkMode}>\r\n        <Head>\r\n          <title>Error - Chat</title>\r\n        </Head>\r\n        <ErrorContainer darkMode={darkMode}>\r\n          <h3>Error loading chat</h3>\r\n          <p>{error}</p>\r\n          <button onClick={() => router.push(\"/\")}>Return to Home</button>\r\n        </ErrorContainer>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <Container darkMode={darkMode}>\r\n        <Head>\r\n          <title>Loading...</title>\r\n        </Head>\r\n        <LoadingContainer darkMode={darkMode}>\r\n          <LoadingSpinner darkMode={darkMode} />\r\n          <p>Loading chat...</p>\r\n        </LoadingContainer>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Container darkMode={darkMode}>\r\n      <Head>\r\n        <title>Chat</title>\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\" />\r\n      </Head>\r\n\r\n      <AppContainer>\r\n        {/* Mobile overlay */}\r\n        {isMobile && sidebarOpen && (\r\n          <Overlay onClick={() => setSidebarOpen(false)} />\r\n        )}\r\n\r\n        <Sidebar \r\n          isMobile={isMobile} \r\n          sidebarOpen={sidebarOpen} \r\n          setSidebarOpen={setSidebarOpen}\r\n        />\r\n\r\n        <ChatContainer darkMode={darkMode}>\r\n          <ChatScreen \r\n            chat={chat} \r\n            messages={null}\r\n            isMobile={isMobile}\r\n            onToggleSidebar={() => setSidebarOpen(true)}\r\n          />\r\n        </ChatContainer>\r\n      </AppContainer>\r\n    </Container>\r\n  );\r\n}\r\n\r\nexport default ChatPage;\r\n\r\n// Styled Components\r\nconst Container = styled.div`\r\n  background-color: ${props => props.darkMode ? '#1e1e1e' : 'white'};\r\n  min-height: 100vh;\r\n  overflow: hidden;\r\n`;\r\n\r\nconst AppContainer = styled.div`\r\n  display: flex;\r\n  height: 100vh;\r\n  overflow: hidden;\r\n  position: relative;\r\n  box-shadow: 1px 1px 4px -1px rgba(0, 0, 0, 0.75);\r\n`;\r\n\r\nconst Overlay = styled.div`\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background-color: rgba(0, 0, 0, 0.5);\r\n  z-index: 998;\r\n  \r\n  @media (min-width: 1025px) {\r\n    display: none;\r\n  }\r\n`;\r\n\r\nconst ChatContainer = styled.div`\r\n  flex: 1;\r\n  overflow: hidden;\r\n  height: 100vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  background-color: ${props => props.darkMode ? '#121212' : '#f0f2f5'};\r\n\r\n  @media (max-width: 1024px) {\r\n    width: 100%;\r\n  }\r\n`;\r\n\r\nconst ErrorContainer = styled.div`\r\n  text-align: center;\r\n  padding: 20px;\r\n  margin: 20px;\r\n  background: ${props => props.darkMode ? '#2a2a2a' : 'white'};\r\n  color: ${props => props.darkMode ? '#e0e0e0' : '#000'};\r\n  border-radius: 8px;\r\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);\r\n\r\n  > h3 {\r\n    margin: 0 0 10px 0;\r\n    color: ${props => props.darkMode ? '#ff6b6b' : '#d32f2f'};\r\n  }\r\n\r\n  > p {\r\n    margin: 10px 0;\r\n    color: ${props => props.darkMode ? '#ccc' : '#666'};\r\n  }\r\n\r\n  > button {\r\n    margin-top: 10px;\r\n    padding: 10px 20px;\r\n    background: #25D366;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 4px;\r\n    cursor: pointer;\r\n    font-size: 14px;\r\n    font-weight: 500;\r\n    transition: background 0.2s;\r\n\r\n    &:hover {\r\n      background: #20ba5a;\r\n    }\r\n\r\n    &:active {\r\n      transform: scale(0.98);\r\n    }\r\n  }\r\n`;\r\n\r\nconst OfflineMessage = styled.div`\r\n  text-align: center;\r\n  padding: 20px;\r\n  margin: 20px;\r\n  background-color: ${props => props.darkMode ? '#3a3a00' : '#fff3cd'};\r\n  color: ${props => props.darkMode ? '#ffeb3b' : '#856404'};\r\n  border: 1px solid ${props => props.darkMode ? '#5a5a00' : '#ffeeba'};\r\n  border-radius: 8px;\r\n  font-size: 16px;\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n`;\r\n\r\nconst LoadingContainer = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  height: 100vh;\r\n  background-color: ${props => props.darkMode ? '#1e1e1e' : '#f0f2f5'};\r\n\r\n  > p {\r\n    margin-top: 20px;\r\n    color: ${props => props.darkMode ? '#888' : '#666'};\r\n    font-size: 16px;\r\n  }\r\n`;\r\n\r\nconst LoadingSpinner = styled.div`\r\n  width: 50px;\r\n  height: 50px;\r\n  border: 4px solid ${props => props.darkMode ? '#333' : '#e0e0e0'};\r\n  border-top: 4px solid #25D366;\r\n  border-radius: 50%;\r\n  animation: spin 1s linear infinite;\r\n\r\n  @keyframes spin {\r\n    0% { transform: rotate(0deg); }\r\n    100% { transform: rotate(360deg); }\r\n  }\r\n`;"],"names":[],"mappings":"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","debugId":null}}]
}