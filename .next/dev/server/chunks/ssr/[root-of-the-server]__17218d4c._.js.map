{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/waels/OneDrive/Desktop/Expo%20projects/P3/pages/chat/%5Bid%5D.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { auth, db } from \"../../firebase\";\r\nimport styled from \"styled-components\";\r\nimport dynamic from \"next/dynamic\";\r\nimport Head from \"next/head\";\r\nimport { useRouter } from \"next/router\";\r\nimport { doc, getDoc } from \"firebase/firestore\";\r\n\r\nconst Sidebar = dynamic(() => import(\"../../components/Sidebar\"), { ssr: false });\r\nconst ChatScreen = dynamic(() => import(\"../../components/ChatScreen\"), { ssr: false });\r\n\r\nfunction ChatPage() {\r\n  const [isOnline, setIsOnline] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const router = useRouter();\r\n  const chatId = router.query.id;\r\n  const [chat, setChat] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Add online/offline detection\r\n  useEffect(() => {\r\n    const handleOnline = () => setIsOnline(true);\r\n    const handleOffline = () => setIsOnline(false);\r\n\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n    setIsOnline(navigator.onLine);\r\n\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!chatId || !isOnline) return;\r\n\r\n    let mounted = true;\r\n    const fetchChat = async () => {\r\n      try {\r\n        setError(null);\r\n        const chatRef = doc(db, \"chats\", chatId);\r\n        const chatSnap = await getDoc(chatRef);\r\n\r\n        if (!chatSnap.exists()) {\r\n          throw new Error(\"Chat not found\");\r\n        }\r\n\r\n        if (mounted) {\r\n          setChat({ id: chatSnap.id, ...chatSnap.data() });\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Error fetching chat:\", err);\r\n        if (mounted) {\r\n          setError(err.message);\r\n          // Only redirect on specific errors\r\n          if (err.code === \"not-found\") {\r\n            router.replace(\"/\");\r\n          }\r\n        }\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchChat();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [chatId, router, isOnline]);\r\n\r\n  if (!isOnline) {\r\n    return (\r\n      <Container>\r\n        <OfflineMessage>\r\n          You are currently offline. Please check your internet connection.\r\n        </OfflineMessage>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <Container>\r\n        <ErrorContainer>\r\n          <h3>Error loading chat</h3>\r\n          <p>{error}</p>\r\n          <button onClick={() => router.push(\"/\")}>Return to Home</button>\r\n        </ErrorContainer>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  if (loading) return <div>Loading...</div>;\r\n\r\n  return (\r\n    <Container>\r\n      <Head>\r\n        <title>Chat</title>\r\n      </Head>\r\n      <Sidebar />\r\n      <ChatContainer>\r\n        <ChatScreen chat={chat} messages={null} />\r\n      </ChatContainer>\r\n    </Container>\r\n  );\r\n}\r\n\r\nexport default ChatPage;\r\n\r\nconst Container = styled.div`\r\n  display: flex;\r\n  box-shadow: 1px 1px 4px -1px rgba(0, 0, 0, 0.75);\r\n`;\r\n\r\nconst ChatContainer = styled.div`\r\n  flex: 1;\r\n  overflow: scroll;\r\n  height: 100vh;\r\n\r\n  ::-webkit-scrollbar {\r\n    display: none;\r\n  }\r\n  -ms-overflow-style: none; /* IE and Edge */\r\n  scrollbar-width: none; /* Firefox */\r\n`;\r\n\r\nconst ErrorContainer = styled.div`\r\n  text-align: center;\r\n  padding: 20px;\r\n  margin: 20px;\r\n  background: white;\r\n  border-radius: 8px;\r\n  box-shadow: 0 1px 3px rgba(0,0,0,0.12);\r\n\r\n  > button {\r\n    margin-top: 10px;\r\n    padding: 8px 16px;\r\n    background: #25D366;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 4px;\r\n    cursor: pointer;\r\n  }\r\n`;\r\n\r\nconst OfflineMessage = styled.div`\r\n  text-align: center;\r\n  padding: 20px;\r\n  margin: 20px;\r\n  background-color: #fff3cd;\r\n  color: #856404;\r\n  border: 1px solid #ffeeba;\r\n  border-radius: 4px;\r\n`;"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;AAEA,MAAM,UAAU,IAAA,mIAAO,EAAC;;;;;;IAA4C,KAAK;;AACzE,MAAM,aAAa,IAAA,mIAAO,EAAC;;;;;;IAA+C,KAAK;;AAE/E,SAAS;IACP,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+GAAQ,EAAC;IACzC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,+GAAQ,EAAC;IACnC,MAAM,SAAS,IAAA,oIAAS;IACxB,MAAM,SAAS,OAAO,KAAK,CAAC,EAAE;IAC9B,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,+GAAQ,EAAC;IACjC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,+GAAQ,EAAC;IAEvC,+BAA+B;IAC/B,IAAA,gHAAS,EAAC;QACR,MAAM,eAAe,IAAM,YAAY;QACvC,MAAM,gBAAgB,IAAM,YAAY;QAExC,OAAO,gBAAgB,CAAC,UAAU;QAClC,OAAO,gBAAgB,CAAC,WAAW;QACnC,YAAY,UAAU,MAAM;QAE5B,OAAO;YACL,OAAO,mBAAmB,CAAC,UAAU;YACrC,OAAO,mBAAmB,CAAC,WAAW;QACxC;IACF,GAAG,EAAE;IAEL,IAAA,gHAAS,EAAC;QACR,IAAI,CAAC,UAAU,CAAC,UAAU;QAE1B,IAAI,UAAU;QACd,MAAM,YAAY;YAChB,IAAI;gBACF,SAAS;gBACT,MAAM,UAAU,IAAA,iJAAG,EAAC,uHAAE,EAAE,SAAS;gBACjC,MAAM,WAAW,MAAM,IAAA,oJAAM,EAAC;gBAE9B,IAAI,CAAC,SAAS,MAAM,IAAI;oBACtB,MAAM,IAAI,MAAM;gBAClB;gBAEA,IAAI,SAAS;oBACX,QAAQ;wBAAE,IAAI,SAAS,EAAE;wBAAE,GAAG,SAAS,IAAI,EAAE;oBAAC;gBAChD;YACF,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,wBAAwB;gBACtC,IAAI,SAAS;oBACX,SAAS,IAAI,OAAO;oBACpB,mCAAmC;oBACnC,IAAI,IAAI,IAAI,KAAK,aAAa;wBAC5B,OAAO,OAAO,CAAC;oBACjB;gBACF;YACF,SAAU;gBACR,IAAI,SAAS,WAAW;YAC1B;QACF;QAEA;QACA,OAAO;YACL,UAAU;QACZ;IACF,GAAG;QAAC;QAAQ;QAAQ;KAAS;IAE7B,IAAI,CAAC,UAAU;QACb,qBACE,qKAAC;sBACC,cAAA,qKAAC;0BAAe;;;;;;;;;;;IAKtB;IAEA,IAAI,OAAO;QACT,qBACE,qKAAC;sBACC,cAAA,qKAAC;;kCACC,qKAAC;kCAAG;;;;;;kCACJ,qKAAC;kCAAG;;;;;;kCACJ,qKAAC;wBAAO,SAAS,IAAM,OAAO,IAAI,CAAC;kCAAM;;;;;;;;;;;;;;;;;IAIjD;IAEA,IAAI,SAAS,qBAAO,qKAAC;kBAAI;;;;;;IAEzB,qBACE,qKAAC;;0BACC,qKAAC,gIAAI;0BACH,cAAA,qKAAC;8BAAM;;;;;;;;;;;0BAET,qKAAC;;;;;0BACD,qKAAC;0BACC,cAAA,qKAAC;oBAAW,MAAM;oBAAM,UAAU;;;;;;;;;;;;;;;;;AAI1C;uCAEe;AAEf,MAAM,YAAY,4IAAM,CAAC,GAAG,CAAC;;;AAG7B,CAAC;AAED,MAAM,gBAAgB,4IAAM,CAAC,GAAG,CAAC;;;;;;;;;;AAUjC,CAAC;AAED,MAAM,iBAAiB,4IAAM,CAAC,GAAG,CAAC;;;;;;;;;;;;;;;;;AAiBlC,CAAC;AAED,MAAM,iBAAiB,4IAAM,CAAC,GAAG,CAAC;;;;;;;;AAQlC,CAAC","debugId":null}}]
}