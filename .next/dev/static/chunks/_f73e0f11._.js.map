{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/waels/OneDrive/Desktop/Expo%20projects/P3/utils/getRecipientEmail.js"],"sourcesContent":["// utils/getRecipientEmail.js\r\n\r\n/**\r\n * Get the recipient email for a chat (WhatsApp-style)\r\n * @param {string[]} users - Array of user emails in the chat\r\n * @param {Object} userLoggedIn - Current logged-in user\r\n * @returns {string|null} Recipient email or null\r\n */\r\nconst getRecipientEmail = (users, userLoggedIn) => {\r\n  // ===================================\r\n  // 1ï¸âƒ£ VALIDATION\r\n  // ===================================\r\n  if (!users || !Array.isArray(users) || !userLoggedIn?.email) {\r\n    console.log(\"âŒ Invalid input data\");\r\n    return null;\r\n  }\r\n\r\n  const currentUserEmail = userLoggedIn.email.toLowerCase().trim();\r\n  \r\n  // Clean and normalize all emails\r\n  const cleanedUsers = users\r\n    .filter(email => email && typeof email === 'string')\r\n    .map(email => email.toLowerCase().trim());\r\n\r\n  // Chat must have at least 1 user\r\n  if (cleanedUsers.length === 0) {\r\n    console.error(\"âŒ No valid users in chat\");\r\n    return null;\r\n  }\r\n\r\n  // ===================================\r\n  // 2ï¸âƒ£ SELF-CHAT DETECTION (Saved Messages)\r\n  // ===================================\r\n  // Get unique participants\r\n  const uniqueParticipants = [...new Set(cleanedUsers)];\r\n\r\n  // If there's only ONE unique participant and it's ME â†’ Self-chat\r\n  if (uniqueParticipants.length === 1 && uniqueParticipants[0] === currentUserEmail) {\r\n    return currentUserEmail;\r\n  }\r\n\r\n  // ===================================\r\n  // 3ï¸âƒ£ REGULAR CHAT - Find Other Person\r\n  // ===================================\r\n  // Find the first person who is NOT me\r\n  const recipient = cleanedUsers.find(email => email !== currentUserEmail);\r\n\r\n  if (recipient) {\r\n    return recipient;\r\n  }\r\n\r\n  // ===================================\r\n  // 4ï¸âƒ£ ERROR: Only contains current user (Corrupted)\r\n  // ===================================\r\n  console.error(\"âŒ CORRUPTED CHAT: Only current user exists (not duplicated for self-chat)\", {\r\n    users: cleanedUsers,\r\n    currentUser: currentUserEmail,\r\n  });\r\n  \r\n  return null;\r\n};\r\n\r\nexport default getRecipientEmail;"],"names":[],"mappings":"AAAA,6BAA6B;AAE7B;;;;;CAKC;;;;AACD,MAAM,oBAAoB,CAAC,OAAO;IAChC,sCAAsC;IACtC,iBAAiB;IACjB,sCAAsC;IACtC,IAAI,CAAC,SAAS,CAAC,MAAM,OAAO,CAAC,UAAU,CAAC,cAAc,OAAO;QAC3D,QAAQ,GAAG,CAAC;QACZ,OAAO;IACT;IAEA,MAAM,mBAAmB,aAAa,KAAK,CAAC,WAAW,GAAG,IAAI;IAE9D,iCAAiC;IACjC,MAAM,eAAe,MAClB,MAAM,CAAC,CAAA,QAAS,SAAS,OAAO,UAAU,UAC1C,GAAG,CAAC,CAAA,QAAS,MAAM,WAAW,GAAG,IAAI;IAExC,iCAAiC;IACjC,IAAI,aAAa,MAAM,KAAK,GAAG;QAC7B,QAAQ,KAAK,CAAC;QACd,OAAO;IACT;IAEA,sCAAsC;IACtC,2CAA2C;IAC3C,sCAAsC;IACtC,0BAA0B;IAC1B,MAAM,qBAAqB;WAAI,IAAI,IAAI;KAAc;IAErD,iEAAiE;IACjE,IAAI,mBAAmB,MAAM,KAAK,KAAK,kBAAkB,CAAC,EAAE,KAAK,kBAAkB;QACjF,OAAO;IACT;IAEA,sCAAsC;IACtC,uCAAuC;IACvC,sCAAsC;IACtC,sCAAsC;IACtC,MAAM,YAAY,aAAa,IAAI,CAAC,CAAA,QAAS,UAAU;IAEvD,IAAI,WAAW;QACb,OAAO;IACT;IAEA,sCAAsC;IACtC,oDAAoD;IACpD,sCAAsC;IACtC,QAAQ,KAAK,CAAC,6EAA6E;QACzF,OAAO;QACP,aAAa;IACf;IAEA,OAAO;AACT;uCAEe","debugId":null}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/waels/OneDrive/Desktop/Expo%20projects/P3/components/Sidebar.js"],"sourcesContent":["// components/Sidebar.js\r\n\r\nimport React, { useMemo, useState, useEffect } from 'react';\r\nimport { collection, query, where, onSnapshot, orderBy } from 'firebase/firestore';\r\nimport { db } from '../firebase';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport getRecipientEmail from '../utils/getRecipientEmail';\r\nimport ChatListItem from './ChatListItem';\r\n\r\nconst Sidebar = ({ onChatSelect, activeChatId }) => {\r\n  const { user: userLoggedIn } = useAuth();\r\n  const [chats, setChats] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n\r\n  // ===================================\r\n  // ðŸ“¨ LOAD USER'S CHATS\r\n  // ===================================\r\n  useEffect(() => {\r\n    if (!userLoggedIn?.email) {\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    console.log(`ðŸ“¨ Loading chats for: ${userLoggedIn.email}`);\r\n\r\n    const chatsRef = collection(db, 'chats');\r\n    const q = query(\r\n      chatsRef,\r\n      where('users', 'array-contains', userLoggedIn.email),\r\n      orderBy('lastMessageTime', 'desc')\r\n    );\r\n\r\n    const unsubscribe = onSnapshot(\r\n      q,\r\n      (snapshot) => {\r\n        const chatsData = snapshot.docs.map(doc => ({\r\n          chatId: doc.id,\r\n          ...doc.data()\r\n        }));\r\n        \r\n        console.log(`âœ… Loaded ${chatsData.length} chats`);\r\n        setChats(chatsData);\r\n        setLoading(false);\r\n      },\r\n      (error) => {\r\n        console.error('âŒ Error loading chats:', error);\r\n        setLoading(false);\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      console.log('ðŸ”Œ Unsubscribing from chats');\r\n      unsubscribe();\r\n    };\r\n  }, [userLoggedIn]);\r\n\r\n  // ===================================\r\n  // âœ… MEMOIZED CHAT PROCESSING\r\n  // ===================================\r\n  const processedChats = useMemo(() => {\r\n    if (!userLoggedIn) return [];\r\n\r\n    return chats\r\n      .map(chat => {\r\n        const recipientEmail = getRecipientEmail(chat.users, userLoggedIn);\r\n        \r\n        // Skip chats with no valid recipient\r\n        if (!recipientEmail) {\r\n          console.warn(`âš ï¸ Skipping chat ${chat.chatId} - no valid recipient`);\r\n          return null;\r\n        }\r\n\r\n        const isSelfChat = recipientEmail === userLoggedIn.email;\r\n\r\n        return {\r\n          ...chat,\r\n          recipientEmail,\r\n          isSelfChat,\r\n          displayName: isSelfChat ? 'Saved Messages' : recipientEmail\r\n        };\r\n      })\r\n      .filter(Boolean); // Remove null entries\r\n  }, [chats, userLoggedIn]);\r\n\r\n  // ===================================\r\n  // âœ… MEMOIZED SEARCH FILTERING\r\n  // ===================================\r\n  const filteredChats = useMemo(() => {\r\n    if (!searchQuery.trim()) return processedChats;\r\n\r\n    const query = searchQuery.toLowerCase();\r\n    return processedChats.filter(chat => \r\n      chat.displayName.toLowerCase().includes(query) ||\r\n      chat.lastMessage?.toLowerCase().includes(query)\r\n    );\r\n  }, [processedChats, searchQuery]);\r\n\r\n  // ===================================\r\n  // ðŸŽ¨ RENDER\r\n  // ===================================\r\n  return (\r\n    <div className=\"sidebar\">\r\n      {/* Header */}\r\n      <div className=\"sidebar-header\">\r\n        <h2>Chats</h2>\r\n      </div>\r\n\r\n      {/* Search */}\r\n      <div className=\"search-container\">\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Search chats...\"\r\n          value={searchQuery}\r\n          onChange={(e) => setSearchQuery(e.target.value)}\r\n          className=\"search-input\"\r\n        />\r\n      </div>\r\n\r\n      {/* Chat List */}\r\n      <div className=\"chat-list\">\r\n        {loading ? (\r\n          <div className=\"loading\">Loading chats...</div>\r\n        ) : filteredChats.length === 0 ? (\r\n          <div className=\"no-chats\">\r\n            <p>{searchQuery ? 'No chats found' : 'No chats yet'}</p>\r\n          </div>\r\n        ) : (\r\n          filteredChats.map((chat) => (\r\n            <ChatListItem\r\n              key={chat.chatId}\r\n              chat={chat}\r\n              isActive={chat.chatId === activeChatId}\r\n              onClick={() => onChatSelect(chat.chatId, chat.users)}\r\n            />\r\n          ))\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Sidebar;\r\n\r\n// Updated Styled Components with responsive design\r\nconst Overlay = styled.div`\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background-color: rgba(0, 0, 0, 0.5);\r\n  z-index: 998;\r\n  \r\n  @media (min-width: 1025px) {\r\n    display: none;\r\n  }\r\n`;\r\n\r\n// components/Sidebar.jsx - Better responsive Container\r\nconst Container = styled.div`\r\n  flex: 0.45;\r\n  border-right: 1px solid ${props => props.darkMode ? '#333' : 'whitesmoke'};\r\n  height: 100vh;\r\n  min-width: 300px;\r\n  max-width: 350px;\r\n  overflow-y: scroll;\r\n  display: flex;\r\n  flex-direction: column;\r\n  background-color: ${props => props.darkMode ? '#1e1e1e' : 'white'};\r\n  color: ${props => props.darkMode ? '#e0e0e0' : 'black'};\r\n\r\n  ::-webkit-scrollbar {\r\n    display: none;\r\n  }\r\n\r\n  -ms-overflow-style: none;\r\n  scrollbar-width: none;\r\n\r\n  /* Mobile and Tablet Responsive */\r\n  @media (max-width: 1024px) {\r\n    ${props => props.sidebarOpen ? `\r\n      /* When sidebar is open on mobile - take full width */\r\n      position: fixed;\r\n      left: 0;\r\n      top: 0;\r\n      bottom: 0;\r\n      right: 0;\r\n      z-index: 999;\r\n      max-width: 100%;\r\n      width: 100%;\r\n      transform: translateX(0);\r\n    ` : `\r\n      /* When sidebar is closed - hide off screen */\r\n      position: fixed;\r\n      left: 0;\r\n      top: 0;\r\n      bottom: 0;\r\n      z-index: 999;\r\n      max-width: 85%;\r\n      width: 85%;\r\n      transform: translateX(-100%);\r\n    `}\r\n    transition: transform 0.3s ease-in-out;\r\n    box-shadow: ${props => props.sidebarOpen ? '2px 0 10px rgba(0,0,0,0.3)' : 'none'};\r\n  }\r\n`;\r\n\r\nconst UserAvatar = styled(Avatar)`\r\n  cursor: pointer;\r\n\r\n  :hover {\r\n    opacity: 0.8;\r\n  }\r\n`;\r\n\r\nconst SidebarButton = styled(Button)`\r\n  width: 100%;\r\n  &&& {\r\n    border-top: 1px solid whitesmoke;\r\n    border-bottom: 1px solid whitesmoke;\r\n  }\r\n`;\r\n\r\nconst Search = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 5px;\r\n  border-radius: 2px;\r\n  padding: 20px;\r\n  background-color: ${props => props.darkMode ? '#2a2a2a' : 'white'};\r\n`;\r\n\r\nconst SearchInput = styled.input`\r\n  outline-width: 0;\r\n  border: none;\r\n  flex: 1;\r\n  background-color: ${props => props.darkMode ? '#2a2a2a' : 'white'};\r\n  color: ${props => props.darkMode ? '#e0e0e0' : 'black'};\r\n  \r\n  ::placeholder {\r\n    color: ${props => props.darkMode ? '#888' : '#999'};\r\n  }\r\n`;\r\n\r\nconst Header = styled.div`\r\n  display: flex;\r\n  position: sticky;\r\n  top: 0;\r\n  background-color: ${props => props.darkMode ? '#1e1e1e' : 'white'};\r\n  z-index: 1;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 15px;\r\n  height: 80px;\r\n  border-bottom: 1px solid ${props => props.darkMode ? '#333' : 'whitesmoke'};\r\n`;\r\n\r\nconst IconsContainer = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n`;\r\n\r\nconst ChatWrapper = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 0 10px;\r\n  \r\n  &:hover {\r\n    background-color: ${props => props.darkMode ? '#2a2a2a' : '#f5f5f5'};\r\n  }\r\n`;\r\n\r\nconst OptionsButton = styled(IconButton)`\r\n  visibility: hidden;\r\n  \r\n  ${ChatWrapper}:hover & {\r\n    visibility: visible;\r\n  }\r\n`;\r\n\r\nconst LoadingContainer = styled.div`\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  padding: 20px;\r\n  color: ${props => props.darkMode ? '#888' : '#666'};\r\n`;"],"names":[],"mappings":"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","debugId":null}}]
}