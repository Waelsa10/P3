{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/waels/OneDrive/Desktop/Expo%20projects/P3/components/Sidebar.jsx"],"sourcesContent":["// components/Sidebar.jsx (Update the filtered chats section)\r\n// Add these imports at the top\r\nimport { collection, query, orderBy, limit, getDocs } from \"firebase/firestore\";\r\nimport { useState, useEffect } from \"react\";\r\n// Add this state for sorting\r\nconst [chatsList, setChatsList] = useState([]);\r\n\r\n// Add this useEffect to sort chats by latest message\r\nuseEffect(() => {\r\n  if (!chatsSnapshot || !user) {\r\n    setChatsList([]);\r\n    return;\r\n  }\r\n\r\n  const loadChatsWithLatestMessage = async () => {\r\n    const chatsWithMessages = await Promise.all(\r\n      chatsSnapshot.docs\r\n        .filter((chat) => {\r\n          const deletedBy = chat.data().deletedBy || [];\r\n          return !deletedBy.includes(user.email);\r\n        })\r\n        .map(async (chat) => {\r\n          try {\r\n            const messagesRef = collection(db, \"chats\", chat.id, \"messages\");\r\n            const q = query(messagesRef, orderBy(\"timestamp\", \"desc\"), limit(1));\r\n            const snapshot = await getDocs(q);\r\n            \r\n            const latestMessage = snapshot.empty \r\n              ? null \r\n              : {\r\n                  ...snapshot.docs[0].data(),\r\n                  timestamp: snapshot.docs[0].data().timestamp?.toMillis() || 0\r\n                };\r\n\r\n            return {\r\n              id: chat.id,\r\n              data: chat.data(),\r\n              latestMessage,\r\n              latestTimestamp: latestMessage?.timestamp || 0,\r\n            };\r\n          } catch (error) {\r\n            console.error(\"Error loading message for chat:\", chat.id, error);\r\n            return {\r\n              id: chat.id,\r\n              data: chat.data(),\r\n              latestMessage: null,\r\n              latestTimestamp: 0,\r\n            };\r\n          }\r\n        })\r\n    );\r\n\r\n    // Sort by latest message timestamp (newest first)\r\n    const sortedChats = chatsWithMessages.sort((a, b) => {\r\n      return b.latestTimestamp - a.latestTimestamp;\r\n    });\r\n\r\n    setChatsList(sortedChats);\r\n  };\r\n\r\n  loadChatsWithLatestMessage();\r\n}, [chatsSnapshot, user]);\r\n\r\n// Update the filtered chats logic\r\nconst filteredChats = chatsList.filter((chat) => {\r\n  if (!searchTerm.trim()) return true;\r\n  \r\n  const chatUsers = chat.data.users || [];\r\n  const otherUser = chatUsers.find((email) => email !== user.email);\r\n  \r\n  // For self-chat, search by own email\r\n  if (!otherUser) {\r\n    return user.email?.toLowerCase().includes(searchTerm.toLowerCase());\r\n  }\r\n  \r\n  return otherUser?.toLowerCase().includes(searchTerm.toLowerCase());\r\n});"],"names":[],"mappings":"AAAA,6DAA6D;AAC7D,+BAA+B;;AAC/B;AAAA;AACA;;;AACA,6BAA6B;AAC7B,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,sIAAQ,EAAC,EAAE;AAE7C,qDAAqD;AACrD,IAAA,uIAAS,EAAC;IACR,IAAI,CAAC,iBAAiB,CAAC,MAAM;QAC3B,aAAa,EAAE;QACf;IACF;IAEA,MAAM,6BAA6B;QACjC,MAAM,oBAAoB,MAAM,QAAQ,GAAG,CACzC,cAAc,IAAI,CACf,MAAM,CAAC,CAAC;YACP,MAAM,YAAY,KAAK,IAAI,GAAG,SAAS,IAAI,EAAE;YAC7C,OAAO,CAAC,UAAU,QAAQ,CAAC,KAAK,KAAK;QACvC,GACC,GAAG,CAAC,OAAO;YACV,IAAI;gBACF,MAAM,cAAc,IAAA,6KAAU,EAAC,IAAI,SAAS,KAAK,EAAE,EAAE;gBACrD,MAAM,IAAI,IAAA,wKAAK,EAAC,aAAa,IAAA,0KAAO,EAAC,aAAa,SAAS,IAAA,wKAAK,EAAC;gBACjE,MAAM,WAAW,MAAM,IAAA,0KAAO,EAAC;gBAE/B,MAAM,gBAAgB,SAAS,KAAK,GAChC,OACA;oBACE,GAAG,SAAS,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE;oBAC1B,WAAW,SAAS,IAAI,CAAC,EAAE,CAAC,IAAI,GAAG,SAAS,EAAE,cAAc;gBAC9D;gBAEJ,OAAO;oBACL,IAAI,KAAK,EAAE;oBACX,MAAM,KAAK,IAAI;oBACf;oBACA,iBAAiB,eAAe,aAAa;gBAC/C;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,mCAAmC,KAAK,EAAE,EAAE;gBAC1D,OAAO;oBACL,IAAI,KAAK,EAAE;oBACX,MAAM,KAAK,IAAI;oBACf,eAAe;oBACf,iBAAiB;gBACnB;YACF;QACF;QAGJ,kDAAkD;QAClD,MAAM,cAAc,kBAAkB,IAAI,CAAC,CAAC,GAAG;YAC7C,OAAO,EAAE,eAAe,GAAG,EAAE,eAAe;QAC9C;QAEA,aAAa;IACf;IAEA;AACF,GAAG;IAAC;IAAe;CAAK;AAExB,kCAAkC;AAClC,MAAM,gBAAgB,UAAU,MAAM,CAAC,CAAC;IACtC,IAAI,CAAC,WAAW,IAAI,IAAI,OAAO;IAE/B,MAAM,YAAY,KAAK,IAAI,CAAC,KAAK,IAAI,EAAE;IACvC,MAAM,YAAY,UAAU,IAAI,CAAC,CAAC,QAAU,UAAU,KAAK,KAAK;IAEhE,qCAAqC;IACrC,IAAI,CAAC,WAAW;QACd,OAAO,KAAK,KAAK,EAAE,cAAc,SAAS,WAAW,WAAW;IAClE;IAEA,OAAO,WAAW,cAAc,SAAS,WAAW,WAAW;AACjE","debugId":null}}]
}