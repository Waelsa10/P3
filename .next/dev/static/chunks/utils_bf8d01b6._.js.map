{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/waels/OneDrive/Desktop/Expo%20projects/P3/utils/chatHelpers.js"],"sourcesContent":["// utils/chatHelpers.js\r\n\r\n/**\r\n * Generate deterministic chat IDs for both users\r\n */\r\nexport const generateChatIds = (userEmail, recipientEmail) => {\r\n  const user = userEmail.toLowerCase().trim();\r\n  const recipient = recipientEmail.toLowerCase().trim();\r\n  \r\n  return {\r\n    myChatId: `chat_${user}_${recipient}`,\r\n    theirChatId: `chat_${recipient}_${user}`,\r\n  };\r\n};\r\n\r\n/**\r\n * Check if this is a self-chat\r\n */\r\nexport const isSelfChat = (userEmail, recipientEmail) => {\r\n  return userEmail.toLowerCase().trim() === recipientEmail.toLowerCase().trim();\r\n};\r\n\r\n/**\r\n * Generate self-chat ID\r\n */\r\nexport const generateSelfChatId = (userEmail) => {\r\n  return `chat_self_${userEmail.toLowerCase().trim()}`;\r\n};"],"names":[],"mappings":"AAAA,uBAAuB;AAEvB;;CAEC;;;;;;;;AACM,MAAM,kBAAkB,CAAC,WAAW;IACzC,MAAM,OAAO,UAAU,WAAW,GAAG,IAAI;IACzC,MAAM,YAAY,eAAe,WAAW,GAAG,IAAI;IAEnD,OAAO;QACL,UAAU,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,WAAW;QACrC,aAAa,CAAC,KAAK,EAAE,UAAU,CAAC,EAAE,MAAM;IAC1C;AACF;AAKO,MAAM,aAAa,CAAC,WAAW;IACpC,OAAO,UAAU,WAAW,GAAG,IAAI,OAAO,eAAe,WAAW,GAAG,IAAI;AAC7E;AAKO,MAAM,qBAAqB,CAAC;IACjC,OAAO,CAAC,UAAU,EAAE,UAAU,WAAW,GAAG,IAAI,IAAI;AACtD","debugId":null}},
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/waels/OneDrive/Desktop/Expo%20projects/P3/utils/createDualChat.js"],"sourcesContent":["// utils/createDualChat.js\r\n\r\nimport { doc, setDoc, serverTimestamp, getDoc } from 'firebase/firestore';\r\nimport { db } from '../firebase';\r\nimport { generateChatIds, isSelfChat as checkSelfChat, generateSelfChatId } from './chatHelpers';\r\n\r\n/**\r\n * Create two mirrored chat documents - one for each user\r\n */\r\nexport const createDualChat = async (currentUserEmail, recipientEmail) => {\r\n  try {\r\n    console.log(`üìù Creating dual chat: ${currentUserEmail} ‚Üî ${recipientEmail}`);\r\n    \r\n    // Handle self-chat\r\n    if (checkSelfChat(currentUserEmail, recipientEmail)) {\r\n      console.log(`üí¨ Self-chat detected - creating single chat`);\r\n      \r\n      const selfChatId = generateSelfChatId(currentUserEmail);\r\n      \r\n      // Check if exists\r\n      const selfDoc = await getDoc(doc(db, 'chats', selfChatId));\r\n      if (selfDoc.exists()) {\r\n        console.log(`‚ÑπÔ∏è Self-chat already exists: ${selfChatId}`);\r\n        return { myChatId: selfChatId, theirChatId: selfChatId };\r\n      }\r\n      \r\n      // Create self-chat document\r\n      await setDoc(doc(db, 'chats', selfChatId), {\r\n        owner: currentUserEmail,\r\n        recipient: currentUserEmail,\r\n        users: [currentUserEmail, currentUserEmail],\r\n        createdAt: serverTimestamp(),\r\n        lastMessage: '',\r\n        lastMessageTime: serverTimestamp(),\r\n        deletedBy: [],\r\n        archivedBy: [],\r\n        isSelfChat: true,\r\n      });\r\n      \r\n      console.log(`‚úÖ Self-chat created: ${selfChatId}`);\r\n      return { myChatId: selfChatId, theirChatId: selfChatId };\r\n    }\r\n    \r\n    // Generate chat IDs\r\n    const { myChatId, theirChatId } = generateChatIds(currentUserEmail, recipientEmail);\r\n    \r\n    // Check if chats already exist\r\n    const [myDoc, theirDoc] = await Promise.all([\r\n      getDoc(doc(db, 'chats', myChatId)),\r\n      getDoc(doc(db, 'chats', theirChatId))\r\n    ]);\r\n    \r\n    if (myDoc.exists() && theirDoc.exists()) {\r\n      console.log(`‚ÑπÔ∏è Chats already exist`);\r\n      return { myChatId, theirChatId };\r\n    }\r\n    \r\n    // Create both chat documents\r\n    const chatData1 = {\r\n      owner: currentUserEmail,\r\n      recipient: recipientEmail,\r\n      users: [currentUserEmail, recipientEmail],\r\n      createdAt: serverTimestamp(),\r\n      lastMessage: '',\r\n      lastMessageTime: serverTimestamp(),\r\n      deletedBy: [],\r\n      archivedBy: [],\r\n    };\r\n    \r\n    const chatData2 = {\r\n      owner: recipientEmail,\r\n      recipient: currentUserEmail,\r\n      users: [recipientEmail, currentUserEmail],\r\n      createdAt: serverTimestamp(),\r\n      lastMessage: '',\r\n      lastMessageTime: serverTimestamp(),\r\n      deletedBy: [],\r\n      archivedBy: [],\r\n    };\r\n    \r\n    await Promise.all([\r\n      setDoc(doc(db, 'chats', myChatId), chatData1),\r\n      setDoc(doc(db, 'chats', theirChatId), chatData2)\r\n    ]);\r\n    \r\n    console.log(`‚úÖ Dual chats created:`, { myChatId, theirChatId });\r\n    \r\n    return { myChatId, theirChatId };\r\n  } catch (error) {\r\n    console.error('‚ùå Error creating dual chat:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Check if dual chat exists\r\n */\r\nexport const dualChatExists = async (currentUserEmail, recipientEmail) => {\r\n  try {\r\n    if (checkSelfChat(currentUserEmail, recipientEmail)) {\r\n      const selfChatId = generateSelfChatId(currentUserEmail);\r\n      const selfDoc = await getDoc(doc(db, 'chats', selfChatId));\r\n      return selfDoc.exists();\r\n    }\r\n    \r\n    const { myChatId } = generateChatIds(currentUserEmail, recipientEmail);\r\n    const myDoc = await getDoc(doc(db, 'chats', myChatId));\r\n    return myDoc.exists();\r\n  } catch (error) {\r\n    console.error('‚ùå Error checking dual chat:', error);\r\n    return false;\r\n  }\r\n};"],"names":[],"mappings":"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","debugId":null}}]
}